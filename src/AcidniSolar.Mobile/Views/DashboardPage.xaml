<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AcidniSolar.Mobile.ViewModels"
             x:Class="AcidniSolar.Mobile.Views.DashboardPage"
             x:DataType="vm:DashboardViewModel"
             Title="Dashboard"
             BackgroundColor="{StaticResource DarkBackground}">

    <RefreshView Command="{Binding RefreshCommand}"
                 IsRefreshing="{Binding IsRefreshing}"
                 RefreshColor="{StaticResource SolarOrange}">
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="16">

                <!-- â”€â”€ Status Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Grid ColumnDefinitions="*,Auto" Padding="0,8,0,0">
                    <Label Text="â˜€ï¸ Acidni Solar"
                           FontSize="24" FontAttributes="Bold"
                           TextColor="{StaticResource SolarOrange}" />
                    <Label Grid.Column="1"
                           Text="{Binding LastUpdated}"
                           FontSize="12"
                           TextColor="{StaticResource TextMuted}"
                           VerticalOptions="Center" />
                </Grid>

                <!-- â”€â”€ Offline Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Frame IsVisible="{Binding IsOffline}"
                       BackgroundColor="#44FF5722"
                       BorderColor="Transparent"
                       Padding="12" CornerRadius="8">
                    <Label Text="ðŸ“¡ You are offline. Showing last cached data."
                           TextColor="{StaticResource TextLight}"
                           FontSize="14" />
                </Frame>

                <!-- â”€â”€ Not Configured Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Frame IsVisible="{Binding IsConfigured, Converter={StaticResource InvertedBoolConverter}}"
                       BackgroundColor="#44FF9800"
                       BorderColor="Transparent"
                       Padding="16" CornerRadius="12">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="ðŸ”‘ Setup Required"
                               FontSize="18" FontAttributes="Bold"
                               TextColor="White" />
                        <Label Text="Enter your Solar API key in Settings to start monitoring."
                               TextColor="White" FontSize="14" />
                        <Button Text="Go to Settings"
                                Command="{Binding NavigateToSettingsCommand}"
                                BackgroundColor="{StaticResource SolarOrange}"
                                TextColor="{StaticResource DarkBackground}"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                HeightRequest="44" />
                    </VerticalStackLayout>
                </Frame>

                <!-- â”€â”€ Loading Indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <ActivityIndicator IsRunning="{Binding IsLoading}"
                                   IsVisible="{Binding IsLoading}"
                                   Color="{StaticResource SolarOrange}"
                                   HeightRequest="40" />

                <!-- â”€â”€ Solar Production Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Frame BackgroundColor="{StaticResource CardBackground}"
                       BorderColor="Transparent"
                       CornerRadius="12" Padding="16"
                       IsVisible="{Binding IsConfigured}">
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Label Text="â˜€ï¸" FontSize="32" VerticalOptions="Center" />
                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Solar Production"
                                   FontSize="12" TextColor="{StaticResource TextMuted}" />
                            <Label Text="{Binding SolarPowerDisplay}"
                                   FontSize="28" FontAttributes="Bold"
                                   TextColor="{StaticResource SolarOrange}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="2" VerticalOptions="Center"
                                             HorizontalOptions="End">
                            <Label Text="Today"
                                   FontSize="10" TextColor="{StaticResource TextMuted}"
                                   HorizontalOptions="End" />
                            <Label Text="{Binding TodayProductionDisplay}"
                                   FontSize="14" TextColor="{StaticResource TextLight}"
                                   HorizontalOptions="End" />
                        </VerticalStackLayout>
                    </Grid>
                </Frame>

                <!-- â”€â”€ Battery & Grid Row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12"
                      IsVisible="{Binding IsConfigured}">

                    <!-- Battery Card -->
                    <Frame BackgroundColor="{StaticResource CardBackground}"
                           BorderColor="Transparent"
                           CornerRadius="12" Padding="16">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="ðŸ”‹ Battery" FontSize="12"
                                   TextColor="{StaticResource TextMuted}" />
                            <Label Text="{Binding BatteryDisplay}"
                                   FontSize="28" FontAttributes="Bold"
                                   TextColor="{Binding BatteryColor}" />
                            <ProgressBar Progress="{Binding BatterySOC, Converter={StaticResource PercentToProgressConverter}}"
                                         ProgressColor="{Binding BatteryColor}"
                                         HeightRequest="6" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Grid Card -->
                    <Frame Grid.Column="1"
                           BackgroundColor="{StaticResource CardBackground}"
                           BorderColor="Transparent"
                           CornerRadius="12" Padding="16">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="âš¡ Grid" FontSize="12"
                                   TextColor="{StaticResource TextMuted}" />
                            <Label Text="{Binding GridStatusDisplay}"
                                   FontSize="22" FontAttributes="Bold"
                                   TextColor="{Binding IsGridConnected, Converter={StaticResource BoolToGridColorConverter}}" />
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- â”€â”€ Home Consumption Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Frame BackgroundColor="{StaticResource CardBackground}"
                       BorderColor="Transparent"
                       CornerRadius="12" Padding="16"
                       IsVisible="{Binding IsConfigured}">
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Label Text="ðŸ " FontSize="32" VerticalOptions="Center" />
                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Home Consumption"
                                   FontSize="12" TextColor="{StaticResource TextMuted}" />
                            <Label Text="{Binding ConsumptionDisplay}"
                                   FontSize="28" FontAttributes="Bold"
                                   TextColor="{StaticResource TextLight}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="2" VerticalOptions="Center"
                                             HorizontalOptions="End">
                            <Label Text="Today"
                                   FontSize="10" TextColor="{StaticResource TextMuted}"
                                   HorizontalOptions="End" />
                            <Label Text="{Binding TodayConsumptionDisplay}"
                                   FontSize="14" TextColor="{StaticResource TextLight}"
                                   HorizontalOptions="End" />
                        </VerticalStackLayout>
                    </Grid>
                </Frame>

                <!-- â”€â”€ Self-Sufficiency Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Frame BackgroundColor="{StaticResource CardBackground}"
                       BorderColor="Transparent"
                       CornerRadius="12" Padding="16"
                       IsVisible="{Binding IsConfigured}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="ðŸŒ¿ Self-Sufficiency"
                               FontSize="12" TextColor="{StaticResource TextMuted}" />
                        <Grid ColumnDefinitions="*,Auto">
                            <ProgressBar Progress="{Binding SelfSufficiency, Converter={StaticResource PercentToProgressConverter}}"
                                         ProgressColor="LimeGreen"
                                         HeightRequest="8" VerticalOptions="Center" />
                            <Label Grid.Column="1"
                                   Text="{Binding SelfSufficiency, StringFormat='{0:N0}%'}"
                                   FontSize="20" FontAttributes="Bold"
                                   TextColor="LimeGreen" Margin="12,0,0,0" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- â”€â”€ Error Message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Label Text="{Binding ErrorMessage}"
                       IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}"
                       TextColor="OrangeRed" FontSize="14"
                       HorizontalOptions="Center" Margin="0,8" />

                <!-- â”€â”€ Version Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <Label Text="Acidni Solar v20260220-1800"
                       FontSize="10"
                       TextColor="{StaticResource TextMuted}"
                       HorizontalOptions="Center"
                       Margin="0,16,0,0" />

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>
